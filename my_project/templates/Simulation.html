{% extends 'base.html'%}
{% block content %}
<title>Simulation</title>
{% endblock %}

{% block style %}
<br><br>
<style>
/* #CSS พื้นฐาน */
.space {
    padding-left: 30px;
    margin-left: 50px;
}
.fade-in {
    opacity: 0;
    transform: translateY(-20px);
    animation: fadeIn 1.25s ease forwards;
}
@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0)
    }
}

/* #CSS ที่จำเป็นสำหรับ UI */
.gpa-card {
    background: white; border-radius: 12px; max-width: 400px;
    margin: 20px 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 30px; width: 375px;
}
.gpa-content { justify-content: left; }
.gpa-label { color: #666; font-size: 14px; margin-bottom: 8px; }
.gpa-value { font-size: 48px; font-weight: bold; color: #1a1a1a; line-height: 1; }
.gpa-max { color: #999; font-size: 14px; margin-top: 4px; }
.gpa-container { display: flex; flex-direction: row; gap: 0; margin-top: 30px; flex-wrap: wrap; }

.courses-content {
    background: white; border-radius: 20px; padding: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); margin: 30px 50px;
}
.courses-content h2 { color: #333; font-size: 24px; margin-bottom: 25px; }
.add-courses-section {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px; margin-bottom: 25px;
}
.course-input {
    width: 100%; padding: 14px 18px; border: 2px solid #e0e0e0;
    border-radius: 12px; font-size: 16px; outline: none;
}
.course-input:focus { border-color: #667eea; }

/* #CSS สำหรับสถานะความเสี่ยง */
.status-safe { color: #059669; }
.status-warn { color: #e58e14; }
.status-danger { color: #dc2626; }
</style>
{% endblock %}

{% block body %}
<div class="space fade-in">
    <h1>การจำลอง GPS และ GPA</h1>
    <h1 style="color: grey; font-size:medium; font-weight: lighter;">วางแผนและจำลองสถานการณ์เพื่อบรรลุเป้าหมาย GPS และ GPA ที่ต้องการ</h1>
</div>

<div class="courses-content" style="background: #ffffff;">
    <h2 style="font-size: 20px; color: #2d4a9e;">สถานะปัจจุบันของคุณ</h2>
    <p style="color: #666; margin-bottom: 20px;">ข้อมูลจะถูกดึงมาจากหน้า Courses โดยอัตโนมัติ แต่คุณสามารถแก้ไขตัวเลขเพื่อจำลองได้</p>

    <div class="add-courses-section">
        <div>
            <label for="sim_manual_gpa" class="label" style="font-size: 16px; margin-bottom: 8px;">GPA ปัจจุบัน:</label>
            <input type="number" id="sim_manual_gpa" class="course-input" placeholder="GPAX (เช่น 2.75)" step="0.01" min="0" max="4" onchange="updateCurrentStatusDisplay()">
        </div>
        <div>
            <label for="sim_manual_credits" class="label" style="font-size: 16px; margin-bottom: 8px;">หน่วยกิตรวมปัจจุบัน:</label>
            <input type="number" id="sim_manual_credits" class="course-input" placeholder="หน่วยกิต (เช่น 3)" min="0" onchange="updateCurrentStatusDisplay()">
        </div>
    </div>
    
    <div class="gpa-container" style="margin-top: 10px; justify-content: flex-start;">
         <div class="gpa-card" style="width: 300px; padding: 25px; margin: 10px;">
            <div class="gpa-content">
                <div class="gpa-label">สถานะความเสี่ยง (จากข้อมูลที่กรอกใน Courses)</div>
                <span class="gpa-value" id="sim_risk_status" style="font-size: 36px;">-</span>
                <div class="gpa-max">(เกณฑ์ < 2.00 = เสี่ยง ต้องทำเกรดให้ดีขึ้น)</div>
            </div>
        </div>
    </div>
</div>

<div class="courses-content">
    <h2>จำลองเกรดเทอมนี้ (GPS)</h2>
    <p style="color: #666; margin-bottom: 20px;">เพิ่มรายวิชาและเกรดที่คาดหวังในเทอมนี้ เพื่อดูผลกระทบ</p>
    
    <div id="add-courses-section" class="add-courses-section">
        <div>
            <input type="text" id="sim_name" class="course-input" placeholder="ชื่อรายวิชา (จำลอง)">
        </div>
        <div>
            <input type="number" id="sim_credit" class="course-input" placeholder="หน่วยกิต" min="1">
        </div>
        <div>
            <select id="sim_grade" class="course-input">
                <option value="A">A (4.0)</option>
                <option value="B+">B+ (3.5)</option>
                <option value="B">B (3.0)</option>
                <option value="C+">C+ (2.5)</option>
                <option value="C">C (2.0)</option>
                <option value="D+">D+ (1.5)</option>
                <option value="D">D (1.0)</option>
                <option value="F">F (0.0)</option>
            </select>
        </div>
    </div>
    <input type="button" class="add-course" style="width: auto; padding: 14px 25px;" value="เพิ่มวิชาจำลอง" onclick="addSimCourse()">

    <div class="sim-results" style="margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 12px; border: 1px solid #e0e0e0;">
        <h3>ผลการจำลองเทอมนี้:</h3>
        <div class="gpa-container" style="margin-top: 0; justify-content: flex-start;">
            <div class="gpa-card" style="width: 300px; padding: 25px; margin: 10px;">
                <div class="gpa-content">
                    <div class="gpa-label">GPS (เกรดเทอมนี้)</div>
                    <span class="gpa-value" id="sim_gps_result">0.00</span>
                    <div class="gpa-max">จาก <span id="sim_semester_credits">0</span> หน่วยกิต</div>
                </div>
            </div>
            <div class="gpa-card" style="width: 300px; padding: 25px; margin: 10px;">
                <div class="gpa-content">
                    <div class="gpa-label">GPA ใหม่ (หลังจบเทอมนี้)</div>
                    <span class="gpa-value" id="sim_new_gpa_result">0.00</span>
                    <div class="gpa-max">จาก <span id="sim_new_total_credits">0</span> หน่วยกิตรวม</div>
                </div>
            </div>
             <div class="gpa-card" style="width: 300px; padding: 25px; margin: 10px;">
                <div class="gpa-content">
                    <div class="gpa-label">สถานะใหม่</div>
                    <span class="gpa-value" id="sim_new_risk_status" style="font-size: 36px;">-</span>
                    <div class="gpa-max">(เกณฑ์ < 2.00 = เสี่ยง ต้องทำเกรดให้ดีขึ้น)</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="course-list" id="list">
    <h2>รายการวิชาจำลอง</h2>
    <div id="sim_course_list_container">
        <p style="color: #999; text-align: center;">ยังไม่มีวิชาจำลอง...</p>
    </div>
</div>

<div class="courses-content">
    <h2>วางแผนเป้าหมายระยะยาว (เช่น เกียรตินิยม GPA 3.50)</h2>
    <p style="color: #666; margin-bottom: 20px;">ใช้ข้อมูล GPA ใหม่ (หลังจบเทอมนี้) จากการจำลองด้านบนเป็นตัวตั้งต้น</p>
    
    <div class="add-courses-section">
        <div>
            <input type="number" id="goal_target_gpa" class="course-input" placeholder="GPA เป้าหมาย (เช่น 3.25)" min="0" max="4" step="0.01">
        </div>
        <div>
            <input type="number" id="goal_remaining_credits" class="course-input" placeholder="หน่วยกิตที่เหลือทั้งหมด (หลังจบเทอมนี้)" min="0">
        </div>
    </div>
    <input type="button" class="add-course" value="คำนวณความเป็นไปได้" onclick="calculateLongTermGoal()">

    <div class="goal-results" style="margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 12px; border: 1px solid #e0e0e0; display: none;">
        <h3>ผลการประเมินเป้าหมาย:</h3>
        <p id="goal_result_text"></p>
    </div>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}